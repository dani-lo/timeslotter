define(["backbone","underscore","jquery","views/helper/timeslotterform","lib/slotdata","lib/ts","text!slot-create.html"],function(a,b,c,d,e,f,g){"use strict";var h=a.View.extend({el:".createslot",initialize:function(a){return this.tform=new d,this.tform.init({onSubmit:b.bind(this.startCreate,this)}).render(),this.slotData=null,this.owner=a.owner,this.flash=f.getFlash(),this},render:function(){},startCreate:function(a){this.slotsData=new e,this.slotsData.initialize(a),this.$el.append(b.template(g,{name:this.slotsData.name,type:this.slotsData.type,pace:this.slotsData.getPace(),slots:this.slotsData.slots})),this.bindCreateSubview(),this.tform.lock(),this.flash.render("msg","Now select the slots then save, or cancel").show()},bindCreateSubview:function(){this.$el.find(".go-create").on("click",b.bind(function(){this.goCreate()},this)),this.$el.find(".go-cancel").on("click",b.bind(function(){this.goCancel()},this)),this.$el.find(".slotlist_box").on("click",b.bind(function(a){var b=c(a.currentTarget),d=parseInt(b.attr("id").replace("slotbox-",""),10);b.toggleClass("booked"),b.hasClass("booked")?this.slotsData.bookSlot(d):this.slotsData.freeSlot(d)},this))},goCreate:function(){this.owner.appendTimeslot(this.slotsData,!0),console.log(this.slotsData.toObject()),this.tform.unlock(),this.reset(),this.flash.render("success","Your booking has been created").show()},goCancel:function(){this.slotsData=null,this.tform.unlock(),this.reset(),this.flash.render("success","Your booking has been cancelled").show()},reset:function(){this.$el.find(".go-create").off("click"),this.$el.find(".slotlist_box").off("click"),this.$el.find(".slotlist").remove()}});return h});